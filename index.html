<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<meta http-equiv="Cache-Control" content="no-store"/>
<title>Sacado Académie — Atelier d’automatismes</title>

<!-- React, ReactDOM, Babel, Tailwind -->
<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://cdn.tailwindcss.com"></script>

<style>
:root{ --brand:#8374a7; }
body{ margin:0; background:#f8fafc; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; }
.hero{ background:#efe7ff; }
.card{ background:#fff; border:1px solid #e5e7eb; }
.btn{ background:var(--brand); color:#fff; }
.pill{ padding:.45rem .8rem; border:1px solid #e5e7eb; border-radius:999px; background:#fff; cursor:pointer; color:#111827; }
.pill.active{ background:var(--brand); border-color:var(--brand); color:#fff; }
.hdr{ background:#f1f5f9; }

/* ✅ statut prime (rose/vert) */
.ok{ background:#dcfce7 !important; }
.ko{ background:#fee2e2 !important; }

/* Saisie faux = texte fuchsia + bordure rose */
.ko-input{ color:#be185d !important; font-weight:700; }
.ko-border{ border-color:#fda4af !important; box-shadow:0 0 0 2px rgba(244,63,94,.35) inset !important; }

/* Saisie à remplir = violet */
.diag-bg  { background: rgba(131,116,167,.16) !important; }
.diag-txt { color:#8374a7 !important; font-weight:700; }
.fill-hint { background: rgba(131,116,167,.12) !important; }
.violet-border { border-color:#8374a7 !important; box-shadow:0 0 0 2px rgba(131,116,167,.25) inset; }

.progress-wrap{ height:10px; background:#e5e7eb; border-radius:9999px; overflow:hidden; }
.progress-bar{ height:100%; background:#8374a7; transition:width .25s linear; }
.flash { animation: flash-red 600ms ease-in-out; }
@keyframes flash-red { 0%{box-shadow:0 0 0 0 rgba(220,38,38,0);} 30%{box-shadow:0 0 0 6px rgba(220,38,38,.45);} 100%{box-shadow:0 0 0 0 rgba(220,38,38,0);} }

/* ---- DARK MODE -------------------------------------------------------- */
.dark-mode, .dark-mode * { color:#f8fafc !important; }
.dark-mode .card{ background:#111111 !important; border-color:#334155 !important; }
.dark-mode .hdr{ background:#1f2937 !important; }
.dark-mode input, .dark-mode select{ background:#000 !important; color:#f8fafc !important; border-color:#64748b !important; }
.dark-mode .pill{ background:#fff !important; color:#111827 !important; border-color:#e5e7eb !important; }
.dark-mode .pill.active{ background:#a69acc !important; border-color:#a69acc !important; color:#111827 !important; }
.dark-mode .progress-wrap{ background:#0b0b0b !important; }
.dark-mode .progress-bar{ background:#a69acc !important; }

.dark-mode select, .dark-mode option, .dark-mode optgroup {
  background:#0b0b0b !important; color:#f8fafc !important; border-color:#64748b !important;
}
.dark-mode select:focus { border-color:#a69acc !important; box-shadow:0 0 0 2px rgba(166,154,204,.35) inset; }
.dark-mode option:checked { background:#3f3f46 !important; color:#f8fafc !important; }
.dark-mode input[type="checkbox"]{ accent-color:#a69acc; }
label>input[type="checkbox"]:checked+span{ color:#8374a7; font-weight:700; }
.dark-mode label>input[type="checkbox"]:checked+span{ color:#a69acc; font-weight:700; }
.dark-mode .fill-hint{ background: rgba(166,154,204,.22) !important; }

/* --- Bulle DogBot ------------------------------------------------------ */
.bot-bubble{
  display:flex; gap:.75rem; align-items:flex-start;
  border:1px solid #e5e7eb; border-radius:16px; padding:10px 12px; background:#fff;
  box-shadow:0 2px 8px rgba(0,0,0,.05);
}
.bot-bubble.ok{ border-color:#22c55e; }
.bot-bubble.ko{ border-color:#ef4444; }
.bot-bubble .msg{ line-height:1.25; }
.bot-bubble img{ width:36px; height:36px; border-radius:9999px; background:#fff; padding:2px; border:1px solid #e5e7eb; }
.dark-mode .bot-bubble{ background:#0b0b0b !important; border-color:#334155 !important; }
.dark-mode .bot-bubble.ok{ border-color:#16a34a !important; }
.dark-mode .bot-bubble.ko{ border-color:#dc2626 !important; }

@font-face{
  font-family:'OpenDyslexicLocal';
  src:url('OpenDyslexic-Regular.otf') format('opentype'),
      url('OpenDyslexicAlta-Regular.otf') format('opentype');
  font-display:swap;
}

/* --- Correctif Jeu 2 : Table de Pythagore (dark mode) --- */
.dark-mode .pyth-cell,
.dark-mode .fill-hint,
.dark-mode .diag-bg {
  background:#1e1e1e !important;
  color:#f8fafc !important;
}
.dark-mode .hdr {
  background:#111827 !important;
  color:#f8fafc !important;
  font-weight:600;
}
.dark-mode .diag-txt {
  color:#a69acc !important;
}
/* --- ✅ Chiffres visibles en mode noir --- */
.dark-mode .pyth-cell span,
.dark-mode td span:not(.diag-txt) {
  color: #000 !important;
}
</style>
</head>

<body>
<div id="root"></div>

<script type="text/babel" data-presets="env,react">
const {useState,useEffect,useRef} = React;
const BRAND = "#8374a7";
const range=(a,b)=>Array.from({length:b-a+1},(_,i)=>a+i);

/* NAV / HUB */
function TopNav({route,go}) {
  return (
    <div className="mb-6 rounded-3xl overflow-hidden shadow-sm border card">
      <div className="px-4 py-3 text-white flex items-center justify-between" style={{backgroundColor:BRAND}}>
        <div className="flex items-center gap-3">
          <img src="dogbot.png" className="h-8 w-8 rounded-lg bg-white/90 p-1" alt="SACADO"/>
          <div>
            <div className="font-black leading-tight">Sacado Académie</div>
            <div className="text-xs opacity-90">Atelier d’automatismes</div>
          </div>
        </div>
        <img src="dogbot.png" className="h-8 w-8 rounded-full bg-white/90 p-0.5" alt="DogBot"/>
      </div>
      <div className="px-4 py-3 flex flex-wrap gap-2 bg-white/60">
        {[
          {k:"/", label:"Accueil"},
          {k:"/defi", label:"Jeu n°1 – Défi Tables"},
          {k:"/pythagore", label:"Jeu n°2 – Table de Pythagore"},
          {k:"/inverse", label:"Jeu n°3 – Retrouve la multiplication"},
        ].map(tab=>(
          <button key={tab.k} onClick={()=>go(tab.k)} className={"pill "+(route===tab.k?"active":"")}>{tab.label}</button>
        ))}
      </div>
    </div>
  );
}

/* --- composant d'accessibilité : 5 polices visibles --- */
function AccessibilityCard({acc}) {
  const lightSelect = acc.black
    ? { background:'#f8fafc', color:'#111827', borderColor:'#cbd5e1' }
    : {};
  return (
    <div className="card rounded-2xl p-4" style={acc.cardStyle}>
      <div className="font-bold mb-2">Accessibilité</div>
      <div className="flex gap-2 flex-wrap mb-2">
        <select value={acc.font} onChange={e=>acc.setFont(e.target.value)} className="border rounded p-1" style={lightSelect}>
          <option>Arial</option>
          <option>Verdana</option>
          <option>OpenDyslexic</option>
          <option>Comic</option>
          <option>SansSerif</option>
        </select>
        <select value={acc.size} onChange={e=>acc.setSize(parseInt(e.target.value))} className="border rounded p-1" style={lightSelect}>
          {[16,18,20,22,24].map(s=><option key={s} value={s}>{s}px</option>)}
        </select>
      </div>
      <label className="block"><input type="checkbox" checked={acc.yellow} onChange={e=>acc.setYellow(e.target.checked)}/> Fond jaune</label>
      <label className="block"><input type="checkbox" checked={acc.black} onChange={e=>acc.setBlack(e.target.checked)}/> Écran noir</label>
      <div className="mt-2 flex items-center gap-2"><input type="checkbox" checked={acc.audio} onChange={e=>acc.setAudio(e.target.checked)}/><label>Audio (TTS)</label></div>
    </div>
  );
}

/* --- Jeu 2 modifié : bouton Réinitialiser --- */
function GamePythagore({acc}) {
  const {rootBg,rootText,cardStyle}=acc;
  const A=range(2,10), B=range(2,10);
  const [mode,setMode]=useState("random");
  const [count,setCount]=useState(10);
  const [table,setTable]=useState(6);
  const [feedback,setFeedback]=useState(null);
  const [values,setValues]=useState({});
  const [checked,setChecked]=useState({});

  const key=(a,b)=>`${a}x${b}`;
  const blanks=React.useMemo(()=>{
    const set=new Set();
    const all=[]; for(const a of A)for(const b of B) all.push(key(a,b));
    while(set.size<Math.min(count,all.length)) set.add(all[Math.floor(Math.random()*all.length)]);
    return set;
  },[mode,count,table]);

  const onChange=(k,v)=> setValues(p=>({...p,[k]:v.replace(/\D/g,"")}));
  const checkAll=()=>{
    const res={};
    let errors=0;
    for(const a of A)for(const b of B){
      const k=key(a,b);
      if(!blanks.has(k)) continue;
      const good=a*b;
      const val=values[k];
      const ok=val && Number(val)===good;
      res[k]=ok?"ok":"ko";
      if(!ok) errors++;
    }
    setChecked(res);
    setFeedback(errors?{type:"ko",msg:`${errors} erreur${errors>1?"s":""}`}:{type:"ok",msg:"Bravo !"});
  };
  const resetAll=()=>{ setValues({}); setChecked({}); setFeedback(null); };

  return (
    <div className="min-h-screen p-6" style={{backgroundColor:rootBg,color:rootText}}>
      <TopNav route="/pythagore" go={(k)=>location.hash="#"+k}/>
      <div className="max-w-6xl mx-auto">
        <div className="grid xl:grid-cols-3 gap-4 mb-4">
          <AccessibilityCard acc={acc}/>
          <div className="card rounded-2xl p-4" style={cardStyle}>
            <div className="font-bold mb-2">Actions</div>
            <button onClick={checkAll} className="px-4 py-2 rounded-2xl text-white mr-2" style={{backgroundColor:BRAND}}>Corriger</button>
            <button onClick={resetAll} className="px-4 py-2 rounded-2xl border">Réinitialiser</button>
            {feedback && <div className={"mt-2 "+(feedback.type==="ok"?"text-green-600":"text-red-600")}>{feedback.msg}</div>}
          </div>
        </div>
        <div className="overflow-auto">
          <table className="min-w-[900px] border-collapse">
            <thead><tr><th className="p-2 hdr text-left">×</th>{B.map(b=><th key={b} className="p-2 hdr">{b}</th>)}</tr></thead>
            <tbody>
              {A.map(a=>(
                <tr key={a}>
                  <th className="p-2 hdr text-left">{a}</th>
                  {B.map(b=>{
                    const k=`${a}x${b}`, shouldFill=blanks.has(k);
                    const st=checked[k];
                    const cls=st==="ok"?"ok":st==="ko"?"ko":"";
                    return (
                      <td key={k} className={"p-1 text-center "+cls}>
                        {shouldFill?
                          <input value={values[k]||""} onChange={e=>onChange(k,e.target.value)} className={"border rounded px-2 py-2 w-[84px] text-center "+(st==="ko"?"ko-border ko-input":"violet-border diag-txt")}/>:
                          <span>{a*b}</span>}
                      </td>
                    );
                  })}
                </tr>
              ))}
            </tbody>
          </table>
        </div>
        <div className="mt-6"><a href="#/" className="px-4 py-2 rounded-2xl border">Retour au menu</a></div>
      </div>
    </div>
  );
}

/* --- Jeu 3 modifié : bouton Retour --- */
function GameInverse({acc}) {
  const {rootBg,rootText,cardStyle}=acc;
  const [finished,setFinished]=useState(false);
  return (
    <div className="min-h-screen p-6" style={{backgroundColor:rootBg,color:rootText}}>
      <TopNav route="/inverse" go={k=>location.hash="#"+k}/>
      <div className="max-w-4xl mx-auto space-y-6">
        <div className="card p-4 rounded-2xl" style={cardStyle}>
          <p>Contenu du jeu 3 ici...</p>
        </div>
        {finished && <div className="card p-4">Résumé...</div>}
        <div className="mt-6"><a href="#/" className="px-4 py-2 rounded-2xl border">⬅ Retour au menu</a></div>
      </div>
    </div>
  );
}

/* --- App simplifiée pour la démo --- */
function App(){
  const [route,setRoute]=useState(location.hash.replace(/^#/,"")||"/");
  const acc={font:"Arial",setFont:()=>{},size:16,setSize:()=>{},yellow:false,setYellow:()=>{},black:false,setBlack:()=>{},audio:false,setAudio:()=>{},cardStyle:{},rootBg:"#f8fafc",rootText:"#000"};
  useEffect(()=>{const onHash=()=>setRoute(location.hash.replace(/^#/,"")||"/");window.addEventListener("hashchange",onHash);return()=>window.removeEventListener("hashchange",onHash);},[]);
  if(route==="/pythagore") return <GamePythagore acc={acc}/>;
  if(route==="/inverse") return <GameInverse acc={acc}/>;
  return <div className="p-6"><TopNav route="/" go={k=>location.hash="#"+k}/><p>Accueil</p></div>;
}
ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
</script>
</body>
</html>
