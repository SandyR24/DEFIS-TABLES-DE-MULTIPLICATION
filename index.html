<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Sacado AcadÃ©mie â€” Atelier dâ€™automatismes</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
:root { --brand:#8374a7; }
body { margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; background:#f8fafc; color:#111; }

.card{ background:#fff; border:1px solid #e5e7eb; border-radius:16px; }
.btn{ background:var(--brand); color:#fff; border-radius:16px; padding:.6rem 1rem; }
.pill{ padding:.45rem .8rem; border:1px solid #e5e7eb; border-radius:999px; background:#fff; cursor:pointer; color:#111827; }
.pill.active{ background:var(--brand); border-color:var(--brand); color:#fff; }

.dark-mode, .dark-mode * { color:#f8fafc !important; }
.dark-mode { background:#000 !important; }
.dark-mode .card{ background:#111 !important; border-color:#333 !important; }
.dark-mode .pill{ background:#fff !important; color:#111 !important; }
.dark-mode .pill.active{ background:#a69acc !important; border-color:#a69acc !important; color:#111 !important; }

.yellow-mode{ background:#fff7cc !important; color:#111 !important; }
.yellow-mode .card{ background:#fff7cc !important; border-color:#e6db91 !important; }

.progress-wrap{ height:10px; background:#e5e7eb; border-radius:9999px; overflow:hidden; }
.progress-bar{ height:100%; background:#8374a7; transition:width .25s linear; }

</style>
</head>
<body>
<div id="root"></div>

<!-- Librairies React -->
<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<script type="text/babel" data-presets="env,react">
const {useState,useEffect,useRef} = React;
const range=(a,b)=>Array.from({length:b-a+1},(_,i)=>a+i);
const BRAND="#8374a7";

/* ---------- AccessibilitÃ© ---------- */
function useAccessibility(){
  const [font,setFont]=useState("Arial");
  const [size,setSize]=useState(16);
  const [yellow,setYellow]=useState(false);
  const [black,setBlack]=useState(false);
  const [audio,setAudio]=useState(false);

  const toggleYellow=v=>{setYellow(v);if(v) setBlack(false);}
  const toggleBlack=v=>{setBlack(v);if(v) setYellow(false);}

  useEffect(()=>{
    document.body.style.fontFamily=
      font==="Comic"?"'Comic Sans MS',cursive":
      font==="Verdana"?"Verdana,Geneva,Tahoma,sans-serif":
      font==="SansSerif"?"ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,Noto Sans,sans-serif":
      "Arial,Helvetica,sans-serif";
    document.body.style.fontSize=`${size}px`;
  },[font,size]);

  const speak=txt=>{
    if(!audio) return;
    try{
      const u=new SpeechSynthesisUtterance(txt);
      u.lang="fr-FR"; speechSynthesis.cancel(); speechSynthesis.speak(u);
    }catch{}
  }

  const cardStyle={backgroundColor:black?"#111":(yellow?"#fff7cc":"#fff"),color:black?"#f8fafc":"#111"};
  return {font,setFont,size,setSize,yellow,black,audio,setAudio,toggleYellow,toggleBlack,cardStyle,speak};
}

/* ---------- UI ---------- */
function TopNav({route,go}){
  return (
    <div className="mb-6 rounded-3xl overflow-hidden shadow-sm border card">
      <div className="px-4 py-3 text-white flex items-center justify-between" style={{backgroundColor:BRAND}}>
        <div className="font-black">Sacado AcadÃ©mie</div>
        <div className="text-sm opacity-90">Atelier dâ€™automatismes</div>
      </div>
      <div className="px-4 py-3 flex flex-wrap gap-2 bg-white/60">
        {[{k:"/",label:"Accueil"},{k:"/defi",label:"Jeu nÂ°1 â€“ DÃ©fi Tables"},{k:"/pythagore",label:"Jeu nÂ°2 â€“ Table de Pythagore"},{k:"/inverse",label:"Jeu nÂ°3 â€“ Retrouve la multiplication"}]
          .map(t=><button key={t.k} onClick={()=>go(t.k)} className={"pill "+(route===t.k?"active":"")}>{t.label}</button>)}
      </div>
    </div>
  );
}
function AccessibilityCard({acc}){
  const lightSelect=acc.black?{background:'#f8fafc',color:'#111827',borderColor:'#cbd5e1'}:{};
  return (
    <div className="card p-4 rounded-2xl" style={acc.cardStyle}>
      <div className="font-bold mb-2">AccessibilitÃ©</div>
      <div className="flex gap-2 mb-2 flex-wrap">
        <select value={acc.font} onChange={e=>acc.setFont(e.target.value)} className="border rounded p-1" style={lightSelect}>
          <option>Arial</option><option>Comic</option><option>Verdana</option><option>SansSerif</option>
        </select>
        <select value={acc.size} onChange={e=>acc.setSize(parseInt(e.target.value))} className="border rounded p-1" style={lightSelect}>
          {[16,18,20,22,24,26,28,30].map(s=><option key={s} value={s}>{s}px</option>)}
        </select>
      </div>
      <label><input type="checkbox" checked={acc.yellow} onChange={e=>acc.toggleYellow(e.target.checked)}/> Fond jaune</label><br/>
      <label><input type="checkbox" checked={acc.black} onChange={e=>acc.toggleBlack(e.target.checked)}/> Ã‰cran noir</label><br/>
      <label><input type="checkbox" checked={acc.audio} onChange={e=>acc.setAudio(e.target.checked)}/> Audio (TTS)</label>
    </div>
  );
}

/* ---------- Jeu 3 â€” Retrouve la multiplication (4 modes) ---------- */
function GameInverse({acc}){
  const {cardStyle}=acc;
  const [mode,setMode]=useState("classique");
  const [started,setStarted]=useState(false);
  const [finished,setFinished]=useState(false);
  const [questions,setQuestions]=useState([]);
  const [index,setIndex]=useState(0);
  const [answers,setAnswers]=useState([]);
  const [tick,setTick]=useState(0);
  const [timeLimit,setTimeLimit]=useState(15);
  const [questionCount,setQuestionCount]=useState(10);
  const [x,setX]=useState(""); const [y,setY]=useState(""); const [q,setQ]=useState(""); const [pairs,setPairs]=useState([]);
  const rand=(a,b)=>a+Math.floor(Math.random()*(b-a+1));
  const factorPairs=p=>{const r=[];for(let a=2;a<=10;a++)for(let b=a;b<=10;b++)if(a*b===p)r.push([a,b]);return r;}

  useEffect(()=>{if(!started||finished)return;const id=setInterval(()=>setTick(t=>t+1),1000);return()=>clearInterval(id)},[started,finished]);

  const start=()=>{
    const list=[];
    for(let i=0;i<questionCount;i++){
      if(mode==="classique") list.push({kind:"classic",product:rand(2,10)*rand(2,10)});
      else if(mode==="tousCouples"){const a=rand(2,10),b=rand(2,10),p=a*b;list.push({kind:"pairs",product:p,pairs:factorPairs(p)});}
      else if(mode==="manquant"){const a=rand(2,10),b=rand(2,10),missing=Math.random()<.5?"a":"b";list.push({kind:"missing",product:a*b,a,b,missing});}
      else list.push({kind:"div",divisor:rand(2,10),quotient:rand(2,10)});}
    setQuestions(list);setStarted(true);setFinished(false);setIndex(0);setAnswers([]);setTick(0);
    setX("");setY("");setQ("");
  };

  const handleSubmit=()=>{
    const cur=questions[index];if(!cur)return;
    let ok=false,user=null;
    if(cur.kind==="classic"){ok=parseInt(x)*parseInt(y)===cur.product;user=`${x}Ã—${y}`;}
    else if(cur.kind==="pairs"){const exp=new Set(cur.pairs.map(p=>p.join("Ã—")));const prov=new Set(pairs.map(p=>p.join("Ã—")));ok=exp.size===prov.size&&[...exp].every(e=>prov.has(e));user=[...prov].join("; ");}
    else if(cur.kind==="manquant"){const val=parseInt(q);ok=(cur.missing==="a"?val*cur.b===cur.product:val*cur.a===cur.product);user=val;}
    else if(cur.kind==="div"){ok=parseInt(q)===cur.quotient;user=q;}
    setAnswers(a=>[...a,{correct:ok,user}]);
    if(index+1>=questions.length){setFinished(true);setStarted(false);}else{setIndex(i=>i+1);setTick(0);setX("");setY("");setQ("");setPairs([]);}
  };

  const cur=questions[index];
  const tip=mode==="classique"?"Retrouve une multiplication.":mode==="tousCouples"?"Donne tous les couples possibles.":mode==="manquant"?"Trouve le facteur manquant.":"ComplÃ¨te la division.";

  return(
    <div className="min-h-screen p-6" style={{background:acc.black?"#000":acc.yellow?"#fff7cc":"#f8fafc",color:acc.black?"#fff":"#111"}}>
      <TopNav route="/inverse" go={k=>location.hash="#"+k}/>
      <div className="max-w-4xl mx-auto space-y-6">
        {!started&&!finished&&(
          <div className="grid md:grid-cols-3 gap-4">
            <AccessibilityCard acc={acc}/>
            <div className="card p-4 rounded-2xl" style={cardStyle}>
              <div className="font-bold mb-2">Mode</div>
              <label><input type="radio" checked={mode==="classique"} onChange={()=>setMode("classique")}/> Retrouve la multiplication</label><br/>
              <label><input type="radio" checked={mode==="tousCouples"} onChange={()=>setMode("tousCouples")}/> MÃ©morise les doublons</label><br/>
              <label><input type="radio" checked={mode==="manquant"} onChange={()=>setMode("manquant")}/> Trouve le facteur manquant</label><br/>
              <label><input type="radio" checked={mode==="div"} onChange={()=>setMode("div")}/> Multiplications inversÃ©es</label>
              <div className="mt-3 font-bold">Nombre de questions</div>
              {[5,10,15,20].map(n=><button key={n} onClick={()=>setQuestionCount(n)} className={"pill "+(questionCount===n?"active":"")}>{n}</button>)}
              <div className="mt-3 font-bold">Temps par question</div>
              {[15,20].map(s=><button key={s} onClick={()=>setTimeLimit(s)} className={"pill "+(timeLimit===s?"active":"")}>{s}s</button>)}
              <button onClick={()=>setTimeLimit(null)} className={"pill "+(timeLimit==null?"active":"")}>Pas de chrono</button>
            </div>
            <div className="card p-4 rounded-2xl flex flex-col justify-center items-center" style={cardStyle}>
              <button onClick={start} className="px-4 py-2 btn">Commencer</button>
            </div>
          </div>
        )}

        {started&&cur&&(
          <div className="space-y-6">
            <div className="card p-4 rounded-2xl" style={cardStyle}><strong>Consigne :</strong> {tip}</div>
            {cur.kind==="classic"&&(
              <div className="card p-6 rounded-2xl text-center" style={cardStyle}>
                <div className="text-5xl font-black mb-4">{cur.product}</div>
                <input value={x} onChange={e=>setX(e.target.value.replace(/\D/g,""))} className="border rounded p-2 w-20 text-center"/> Ã— 
                <input value={y} onChange={e=>setY(e.target.value.replace(/\D/g,""))} className="border rounded p-2 w-20 text-center"/>
                <button onClick={handleSubmit} className="ml-3 px-4 py-2 btn">Valider</button>
              </div>
            )}
            {cur.kind==="manquant"&&(
              <div className="card p-6 rounded-2xl text-center" style={cardStyle}>
                <div className="text-3xl mb-4">{cur.product} = {cur.missing==="a"?"?":cur.a} Ã— {cur.missing==="b"?"?":cur.b}</div>
                <input value={q} onChange={e=>setQ(e.target.value.replace(/\D/g,""))} className="border rounded p-2 w-24 text-center"/>
                <button onClick={handleSubmit} className="ml-3 px-4 py-2 btn">Valider</button>
              </div>
            )}
            {cur.kind==="div"&&(
              <div className="card p-6 rounded-2xl text-center" style={cardStyle}>
                <div className="text-3xl mb-4">{cur.divisor*cur.quotient} Ã· {cur.divisor} = ?</div>
                <input value={q} onChange={e=>setQ(e.target.value.replace(/\D/g,""))} className="border rounded p-2 w-24 text-center"/>
                <button onClick={handleSubmit} className="ml-3 px-4 py-2 btn">Valider</button>
              </div>
            )}
            {cur.kind==="pairs"&&(
              <div className="card p-6 rounded-2xl text-center" style={cardStyle}>
                <div className="text-3xl mb-4">{cur.product}</div>
                {pairs.map((p,i)=><div key={i}>{p.join("Ã—")}</div>)}
                <button onClick={handleSubmit} className="px-4 py-2 btn">Valider</button>
              </div>
            )}
          </div>
        )}

        {finished&&(
          <div className="card p-6 rounded-2xl text-center" style={cardStyle}>
            <h2 className="text-2xl font-bold mb-2">RÃ©sultats ðŸŽ¯</h2>
            <p>{answers.filter(a=>a.correct).length}/{answers.length} correctes</p>
            <button onClick={()=>{setStarted(false);setFinished(false);}} className="mt-3 px-4 py-2 btn">Rejouer</button>
          </div>
        )}
      </div>
    </div>
  );
}

/* ---------- Jeu 1 + 2 + Hub (versions simples pour intÃ©gration) ---------- */
function Hub(){return(<div className="text-center p-8"><h1 className="text-3xl font-bold text-purple-700">Bienvenue dans lâ€™Atelier dâ€™automatismes</h1><p className="mt-2">Choisis ton jeu ci-dessus ðŸ‘†</p></div>);}
function GameDefi(){return(<div className="text-center p-8">Jeu 1 â€“ DÃ©fi Tables</div>);}
function GamePythagore(){return(<div className="text-center p-8">Jeu 2 â€“ Table de Pythagore</div>);}

/* ---------- APP ---------- */
function App(){
  const [route,setRoute]=useState(location.hash.replace(/^#/,"")||"/");
  const acc=useAccessibility();
  useEffect(()=>{const onHash=()=>setRoute(location.hash.replace(/^#/,"")||"/");window.addEventListener("hashchange",onHash);return()=>window.removeEventListener("hashchange",onHash)},[]);
  return(
    <div className="min-h-screen p-6" style={{background:acc.black?"#000":acc.yellow?"#fff7cc":"#f8fafc",color:acc.black?"#fff":"#111"}}>
      <TopNav route={route} go={k=>location.hash="#"+k}/>
      {route==="/"&&<Hub/>}
      {route==="/defi"&&<GameDefi acc={acc}/>}
      {route==="/pythagore"
